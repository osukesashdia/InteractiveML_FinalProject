{
  "version": 3,
  "sources": ["../../vidstack/dev/providers/vidstack-video.js"],
  "sourcesContent": ["import { onDispose, EventsController, listenEvent, DOMEvent, scoped } from '../chunks/vidstack-Bu2kfzUd.js';\nimport { canUsePictureInPicture, canUseVideoPresentation, canPlayHLSNatively } from '../chunks/vidstack-CjhKISI0.js';\nimport { HTMLMediaProvider } from './vidstack-html.js';\nimport { HTMLAirPlayAdapter } from '../chunks/vidstack-Bo5OTJ06.js';\nimport { TextTrack, TextTrackSymbol } from '../chunks/vidstack-BYNmVJLa.js';\nimport '../chunks/vidstack-qh1N5_f_.js';\nimport '../chunks/vidstack-Dihypf8P.js';\nimport '../chunks/vidstack-Dv_LIPFu.js';\nimport '../chunks/vidstack-zG6PIeGg.js';\nimport '../chunks/vidstack-28cU2iGK.js';\n\nclass NativeHLSTextTracks {\n  #video;\n  #ctx;\n  constructor(video, ctx) {\n    this.#video = video;\n    this.#ctx = ctx;\n    video.textTracks.onaddtrack = this.#onAddTrack.bind(this);\n    onDispose(this.#onDispose.bind(this));\n  }\n  #onAddTrack(event) {\n    const nativeTrack = event.track;\n    if (!nativeTrack || findTextTrackElement(this.#video, nativeTrack)) return;\n    const track = new TextTrack({\n      id: nativeTrack.id,\n      kind: nativeTrack.kind,\n      label: nativeTrack.label ?? \"\",\n      language: nativeTrack.language,\n      type: \"vtt\"\n    });\n    track[TextTrackSymbol.native] = { track: nativeTrack };\n    track[TextTrackSymbol.readyState] = 2;\n    track[TextTrackSymbol.nativeHLS] = true;\n    let lastIndex = 0;\n    const onCueChange = (event2) => {\n      if (!nativeTrack.cues) return;\n      for (let i = lastIndex; i < nativeTrack.cues.length; i++) {\n        track.addCue(nativeTrack.cues[i], event2);\n        lastIndex++;\n      }\n    };\n    onCueChange(event);\n    nativeTrack.oncuechange = onCueChange;\n    this.#ctx.textTracks.add(track, event);\n    track.setMode(nativeTrack.mode, event);\n  }\n  #onDispose() {\n    this.#video.textTracks.onaddtrack = null;\n    for (const track of this.#ctx.textTracks) {\n      const nativeTrack = track[TextTrackSymbol.native]?.track;\n      if (nativeTrack?.oncuechange) nativeTrack.oncuechange = null;\n    }\n  }\n}\nfunction findTextTrackElement(video, track) {\n  return Array.from(video.children).find((el) => el.track === track);\n}\n\nclass VideoPictureInPicture {\n  #video;\n  #media;\n  constructor(video, media) {\n    this.#video = video;\n    this.#media = media;\n    new EventsController(video).add(\"enterpictureinpicture\", this.#onEnter.bind(this)).add(\"leavepictureinpicture\", this.#onExit.bind(this));\n  }\n  get active() {\n    return document.pictureInPictureElement === this.#video;\n  }\n  get supported() {\n    return canUsePictureInPicture(this.#video);\n  }\n  async enter() {\n    return this.#video.requestPictureInPicture();\n  }\n  exit() {\n    return document.exitPictureInPicture();\n  }\n  #onEnter(event) {\n    this.#onChange(true, event);\n  }\n  #onExit(event) {\n    this.#onChange(false, event);\n  }\n  #onChange = (active, event) => {\n    this.#media.notify(\"picture-in-picture-change\", active, event);\n  };\n}\n\nclass VideoPresentation {\n  #video;\n  #media;\n  #mode = \"inline\";\n  get mode() {\n    return this.#mode;\n  }\n  constructor(video, media) {\n    this.#video = video;\n    this.#media = media;\n    listenEvent(video, \"webkitpresentationmodechanged\", this.#onModeChange.bind(this));\n  }\n  get supported() {\n    return canUseVideoPresentation(this.#video);\n  }\n  async setPresentationMode(mode) {\n    if (this.#mode === mode) return;\n    this.#video.webkitSetPresentationMode(mode);\n  }\n  #onModeChange(event) {\n    const prevMode = this.#mode;\n    this.#mode = this.#video.webkitPresentationMode;\n    {\n      this.#media.logger?.infoGroup(\"presentation mode change\").labelledLog(\"Mode\", this.#mode).labelledLog(\"Event\", event).dispatch();\n    }\n    this.#media.player?.dispatch(\n      new DOMEvent(\"video-presentation-change\", {\n        detail: this.#mode,\n        trigger: event\n      })\n    );\n    [\"fullscreen\", \"picture-in-picture\"].forEach((type) => {\n      if (this.#mode === type || prevMode === type) {\n        this.#media.notify(`${type}-change`, this.#mode === type, event);\n      }\n    });\n  }\n}\nclass FullscreenPresentationAdapter {\n  #presentation;\n  get active() {\n    return this.#presentation.mode === \"fullscreen\";\n  }\n  get supported() {\n    return this.#presentation.supported;\n  }\n  constructor(presentation) {\n    this.#presentation = presentation;\n  }\n  async enter() {\n    this.#presentation.setPresentationMode(\"fullscreen\");\n  }\n  async exit() {\n    this.#presentation.setPresentationMode(\"inline\");\n  }\n}\nclass PIPPresentationAdapter {\n  #presentation;\n  get active() {\n    return this.#presentation.mode === \"picture-in-picture\";\n  }\n  get supported() {\n    return this.#presentation.supported;\n  }\n  constructor(presentation) {\n    this.#presentation = presentation;\n  }\n  async enter() {\n    this.#presentation.setPresentationMode(\"picture-in-picture\");\n  }\n  async exit() {\n    this.#presentation.setPresentationMode(\"inline\");\n  }\n}\n\nclass VideoProvider extends HTMLMediaProvider {\n  $$PROVIDER_TYPE = \"VIDEO\";\n  get type() {\n    return \"video\";\n  }\n  airPlay;\n  fullscreen;\n  pictureInPicture;\n  constructor(video, ctx) {\n    super(video, ctx);\n    scoped(() => {\n      this.airPlay = new HTMLAirPlayAdapter(video, ctx);\n      if (canUseVideoPresentation(video)) {\n        const presentation = new VideoPresentation(video, ctx);\n        this.fullscreen = new FullscreenPresentationAdapter(presentation);\n        this.pictureInPicture = new PIPPresentationAdapter(presentation);\n      } else if (canUsePictureInPicture(video)) {\n        this.pictureInPicture = new VideoPictureInPicture(video, ctx);\n      }\n    }, this.scope);\n  }\n  setup() {\n    super.setup();\n    if (canPlayHLSNatively(this.video)) {\n      new NativeHLSTextTracks(this.video, this.ctx);\n    }\n    this.ctx.textRenderers.attachVideo(this.video);\n    onDispose(() => {\n      this.ctx.textRenderers.attachVideo(null);\n    });\n    if (this.type === \"video\") this.ctx.notify(\"provider-setup\", this);\n  }\n  /**\n   * The native HTML `<video>` element.\n   *\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement}\n   */\n  get video() {\n    return this.media;\n  }\n}\n\nexport { VideoProvider };\n"],
  "mappings": "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",
  "names": ["_video", "_media", "_presentation"]
}
